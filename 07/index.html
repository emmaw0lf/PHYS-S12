<!DOCTYPE html>
<html lang="en">

<title>PHYSCI 70: Intro to Digital Fabrication </title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="../style.css" rel="stylesheet">


<nav class="navbar navbar-expand-sm navbar-light bg-light">
  <div style="align-items: left; justify-content:left;" class="container-fluid">
    <h3 style="margin: 15px"> PHYSCI 70: Intro to Digital Fabrication</h3>
    <div class="navbar-nav">
      <h4><a class="nav-link" href="../index.html">Home</a></h4>
      <h4><a class="nav-link" href="../about.html">About</a></h4>
      <h4><a class="nav-link" href="../finalproject.html">Final Project</a></h4>
    </div>
  </div>
</nav>


<body>


<xmp theme="journal" style="display:none;">



<center><h1>7: Electronic Output Devices</h1></center> 

<p>This weeks assignment was to use an output device that you haven't used before today, to
write a microcontroller program that integrates at least one input device and one output device, use an oscilloscope to discover the time domain at which the output device is operating, and to prepare a CAD file for CNC.</p>

<h1><center>Part 1</center></h1>

<p>I decided to experiment with a TFT display, and I wanted to hook it up to the sensor I made last class. Specficially, I wanted to make the display change colors when the sensors were close. It was a little bit of a learning curve to understand the Adafruit display. Eventually I found the code to change the background color, and I wanted to change it into a class

<code><pre>
#include Adafruit_GFX.h 
#include Adafruit_ST7735.h 
#include Adafruit_ST7789.h
#include SPI.h

#if defined(ARDUINO_FEATHER_ESP32) 
#define TFT_CS         14
#define TFT_RST        15
#define TFT_DC         32

#elif defined(ESP8266)
#define TFT_CS         4
#define TFT_RST        16
#define TFT_DC         5

#else

#define TFT_CS        10
#define TFT_RST        9 
#define TFT_DC         8
#endif

Adafruit_ST7789 tft = Adafruit_ST7789(TFT_CS, TFT_DC, TFT_RST);
int red = ST77XX_RED;
int blue = ST77XX_BLUE;

class Background
{
  public:
  int bgColor;
  void screen(int color) {
    tft.fillScreen(color);
  }
  Background(int);
}
;

Background::Background(int backgroundColor): bgColor(backgroundColor) {
  
}



long result;   //variable for the result of the tx_rx measurement.
int analog_pin = A3;
int tx_pin = 4;

Background bg = Background(red);

void setup(void) {
  Serial.begin(9600);
  Serial.print(F("Hello! ST77xx TFT Test"));
  pinMode(tx_pin, OUTPUT);    
  pinMode(13, OUTPUT);
  Serial.begin(9600);
  tft.init(135, 240);         

  Serial.println(F("Initialized"));

  uint16_t time = millis();
  tft.fillScreen(ST77XX_BLACK);
  time = millis() - time;

  Serial.println(time, DEC);
  delay(500);

}

void loop() {
  result = tx_rx();
  Serial.println(result);
  if (result > 6000 && result < 12000) {
    bg.bgColor = red;
    bg.screen(bg.bgColor);

  } else {
    bg.bgColor = blue;
    bg.screen(bg.bgColor);
  }
}


long tx_rx() {        // Function to execute rx_tx algorithm and return a value
  // that depends on coupling of two electrodes.
  // Value returned is a long integer.
  int read_high;
  int read_low;
  int diff;
  long int sum;
  int N_samples = 100;    // Number of samples to take.  Larger number slows it down, but reduces scatter.

  sum = 0;

  for (int i = 0; i < N_samples; i++) {
    digitalWrite(tx_pin, HIGH);             // Step the voltage high on conductor 1.
    read_high = analogRead(analog_pin);     // Measure response of conductor 2.
    delayMicroseconds(100);                 // Delay to reach steady state.
    digitalWrite(tx_pin, LOW);              // Step the voltage to zero on conductor 1.
    read_low = analogRead(analog_pin);      // Measure response of conductor 2.
    diff = read_high - read_low;            // desired answer is the difference between high and low.
    sum += diff;                            // Sums up N_samples of these measurements.


  }
 
  return sum;

}
</pre></code>


</xmp>
</body>

<script src="https://strapdownjs.com/v/0.2/strapdown.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" ></script>

</html>